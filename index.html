<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Athlete's Mindspace</title>
    <!-- Use the DM Sans font from Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
        }
        /* Custom scrollbar for a cleaner look, updated for the new theme */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #e5e7eb; /* Light gray track */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #9ca3af; /* A darker gray for the thumb */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .breathing-circle {
            animation: breathe 5s infinite ease-in-out;
            transition: all 0.5s ease;
        }
        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }
    </style>
</head>
<body class="bg-white text-gray-900 min-h-screen flex items-center justify-center p-4">

    <!-- Main Container, updated background -->
    <div id="app-container" class="bg-green-50 p-6 sm:p-8 rounded-2xl shadow-2xl max-w-lg w-full transform transition-all duration-300">
        
        <!-- Header -->
        <header class="text-center mb-6">
            <!-- App Logo - Replaced the uploaded image with a working placeholder URL -->
            <img src="https://placehold.co/128x128/10b981/fff?text=Mindspace" alt="The Athlete's Mindspace Logo" class="mx-auto mb-4 w-32 h-32 rounded-full">
            <!-- Updated text color to a shade of green -->
            <h1 class="text-3xl font-bold text-green-600">The Athlete's Mindspace</h1>
            <!-- Updated text color to a darker shade -->
            <p class="text-gray-600 mt-1">Nourish your mental game.</p>
        </header>

        <!-- Dynamic Content Area -->
        <div id="content-area" class="animate-fade-in">
            <!-- Initial content will be loaded here by JavaScript -->
        </div>

    </div>

    <!-- Message Modal, updated colors -->
    <div id="message-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-gray-200 p-6 rounded-2xl shadow-lg transform transition-all duration-300">
            <p id="modal-text" class="text-lg text-center text-gray-900"></p>
            <button id="close-modal-btn" class="mt-4 w-full bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-xl transition-colors">OK</button>
        </div>
    </div>

    <script>
        // Use a function to manage localStorage for safety
        function getStoredData(key, defaultValue = {}) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error("Error reading from localStorage:", error);
                return defaultValue;
            }
        }

        function setStoredData(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (error) {
                console.error("Error writing to localStorage:", error);
            }
        }

        // State management
        const state = {
            currentView: 'home',
            dailyData: getStoredData('mindspace_daily_data', []),
            supportCardData: getStoredData('mindspace_support_card', {}),
            mentorProfiles: [
                {
                    name: "Alex 'The Ace' Chen",
                    sport: "Tennis",
                    bio: "Former national champion with a focus on mental toughness. I'll share my strategies for staying calm under pressure and recovering from tough losses. Let's talk about the mindset of a winner.",
                    image: "https://placehold.co/100x100/10b981/fff?text=AC" // Placeholder for an image
                },
                {
                    name: "Taylor 'The Titan' Johnson",
                    sport: "Basketball",
                    bio: "Played professionally for five years. My passion is helping young athletes build resilience and find balance between their sport and personal life. We can discuss dealing with expectations and finding your passion.",
                    image: "https://placehold.co/100x100/38bdf8/fff?text=TJ" // Placeholder for an image
                }
            ],
            totalPoints: getStoredData('mindspace_total_points', 0),
            // New state for the rewards store
            inventory: getStoredData('mindspace_inventory', []),
            rewardsItems: [
                { id: 'stress-ball', name: 'Stress Ball', emoji: 'üü¢', cost: 100, description: 'Squeeze away your anxiety and focus on the game.' },
                { id: 'fidget-spinner', name: 'Relaxing Fidget Spinner', emoji: 'ÔøΩ', cost: 250, description: 'Use this tool to help calm your mind before a competition.' },
                { id: 'calm-colors', name: 'Calm Colors Theme', emoji: 'üé®', cost: 500, description: 'Change your app theme to a soothing color palette.' }
            ]
        };

        // DOM elements
        const contentArea = document.getElementById('content-area');
        const messageModal = document.getElementById('message-modal');
        const modalText = document.getElementById('modal-text');
        const closeModalBtn = document.getElementById('close-modal-btn');
        closeModalBtn.addEventListener('click', () => messageModal.classList.add('hidden'));

        // Helper function to show a custom message modal
        function showMessage(message) {
            modalText.textContent = message;
            messageModal.classList.remove('hidden');
        }

        // Helper to render content and handle fade-in
        function renderContent(html) {
            contentArea.innerHTML = '';
            contentArea.classList.remove('animate-fade-in');
            void contentArea.offsetWidth; // Trigger reflow to restart animation
            contentArea.innerHTML = html;
            contentArea.classList.add('animate-fade-in');
        }

        // --- View Rendering Functions ---

        function renderHomePage() {
            const html = `
                <div class="text-center mb-4">
                    <p class="text-lg text-gray-600">Your total points:</p>
                    <p class="text-4xl font-bold text-green-600">${state.totalPoints}</p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <!-- Daily Check-in Card - changed to green-100 -->
                    <div class="bg-green-100 p-5 rounded-xl shadow-lg cursor-pointer hover:bg-green-200 transition-colors" onclick="navigate('check-in')">
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-3xl">üìù</span>
                        </div>
                        <h3 class="font-bold text-center text-lg text-gray-900">Daily Check-in</h3>
                        <p class="text-sm text-gray-600 text-center">Track your mood & energy.</p>
                    </div>

                    <!-- Mindful Moments Card - changed to green-100 -->
                    <div class="bg-green-100 p-5 rounded-xl shadow-lg cursor-pointer hover:bg-green-200 transition-colors" onclick="navigate('mindful-moments')">
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-3xl">üßò</span>
                        </div>
                        <h3 class="font-bold text-center text-lg text-gray-900">Mindful Moments</h3>
                        <p class="text-sm text-gray-600 text-center">Breathing exercises & focus.</p>
                    </div>

                    <!-- Trends & Insights Card - changed to green-100 -->
                    <div class="bg-green-100 p-5 rounded-xl shadow-lg cursor-pointer hover:bg-green-200 transition-colors" onclick="navigate('insights')">
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-3xl">üìà</span>
                        </div>
                        <h3 class="font-bold text-center text-lg text-gray-900">Trends & Insights</h3>
                        <p class="text-sm text-gray-600 text-center">See your progress over time.</p>
                    </div>

                    <!-- My Support Card - changed to green-100 -->
                    <div class="bg-green-100 p-5 rounded-xl shadow-lg cursor-pointer hover:bg-green-200 transition-colors" onclick="navigate('support-card')">
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-3xl">ü§ù</span>
                        </div>
                        <h3 class="font-bold text-center text-lg text-gray-900">My Support Card</h3>
                        <p class="text-sm text-gray-600 text-center">Talk with parents & coaches.</p>
                    </div>

                    <!-- Connect with Pros Card - changed to green-100 -->
                    <div class="bg-green-100 p-5 rounded-xl shadow-lg cursor-pointer hover:bg-green-200 transition-colors" onclick="navigate('connect-with-pros')">
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-3xl">üèÜ</span>
                        </div>
                        <h3 class="font-bold text-center text-lg text-gray-900">Connect with Pros</h3>
                        <p class="text-sm text-gray-600 text-center">Learn from athletes who have been there.</p>
                    </div>

                    <!-- Mindful Rewards Card (NEW) - changed to green-100 -->
                    <div class="bg-green-100 p-5 rounded-xl shadow-lg cursor-pointer hover:bg-green-200 transition-colors" onclick="navigate('rewards')">
                        <div class="flex items-center justify-center mb-2">
                            <span class="text-3xl">üéÅ</span>
                        </div>
                        <h3 class="font-bold text-center text-lg text-gray-900">Mindful Rewards</h3>
                        <p class="text-sm text-gray-600 text-center">Spend points on cool items!</p>
                    </div>
                </div>
            `;
            renderContent(html);
        }

        function renderCheckInPage() {
            const html = `
                <div class="bg-gray-100 p-6 rounded-xl">
                    <h2 class="text-xl font-bold mb-4 text-center text-gray-900">How are you feeling today?</h2>
                    <form id="check-in-form">
                        <!-- Mood Slider -->
                        <div class="mb-5">
                            <label for="mood" class="block text-gray-600 mb-2">Your Mood: <span id="mood-value" class="text-green-600 font-bold">50</span></label>
                            <input type="range" id="mood" min="0" max="100" value="50" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <!-- Energy Slider -->
                        <div class="mb-5">
                            <label for="energy" class="block text-gray-600 mb-2">Your Energy Level: <span id="energy-value" class="text-green-600 font-bold">50</span></label>
                            <input type="range" id="energy" min="0" max="100" value="50" class="w-full h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <!-- Journal Entry -->
                        <div class="mb-5">
                            <label for="journal" class="block text-gray-600 mb-2">Reflect on your day:</label>
                            <textarea id="journal" class="w-full p-3 bg-white border border-gray-400 rounded-xl focus:outline-none focus:border-green-500 transition-colors" rows="4" placeholder="How did you feel during practice? What went well? What was challenging?"></textarea>
                        </div>
                        
                        <button type="submit" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-xl transition-colors">Submit Check-in</button>
                    </form>
                </div>
                <button class="mt-4 w-full bg-gray-300 hover:bg-gray-400 text-gray-900 font-bold py-2 rounded-xl transition-colors" onclick="navigate('home')">Back to Home</button>
            `;
            renderContent(html);
            
            // Add event listeners for the form and sliders
            const moodSlider = document.getElementById('mood');
            const energySlider = document.getElementById('energy');
            const moodValueSpan = document.getElementById('mood-value');
            const energyValueSpan = document.getElementById('energy-value');

            moodSlider.addEventListener('input', () => moodValueSpan.textContent = moodSlider.value);
            energySlider.addEventListener('input', () => energyValueSpan.textContent = energySlider.value);

            const checkInForm = document.getElementById('check-in-form');
            checkInForm.addEventListener('submit', handleCheckInSubmit);
        }

        function handleCheckInSubmit(event) {
            event.preventDefault();
            const form = event.target;
            const mood = form.mood.value;
            const energy = form.energy.value;
            const journal = form.journal.value;
            const timestamp = new Date().toISOString();

            // Create a new data entry
            const newEntry = {
                date: new Date().toLocaleDateString(),
                timestamp,
                mood: parseInt(mood, 10),
                energy: parseInt(energy, 10),
                journal,
            };

            // Add new entry and save it
            state.dailyData.push(newEntry);
            setStoredData('mindspace_daily_data', state.dailyData);
            
            // Add points for the check-in
            state.totalPoints += 10;
            setStoredData('mindspace_total_points', state.totalPoints);
            
            showMessage('Check-in saved! You earned 10 points.');
            navigate('home');
        }

        function renderMindfulMoments() {
            const html = `
                <div class="bg-gray-100 p-6 rounded-xl text-center">
                    <h2 class="text-xl font-bold mb-4 text-gray-900">Mindful Moments</h2>
                    <p id="breathing-instruction" class="text-gray-600 mb-6">Tap to start a 60-second breathing exercise.</p>
                    <div class="flex justify-center items-center">
                        <div id="breathing-circle" class="breathing-circle w-32 h-32 bg-green-600 rounded-full cursor-pointer shadow-lg hover:bg-green-500 transition-colors"></div>
                    </div>
                    <p id="breathing-timer" class="mt-4 text-2xl font-bold text-green-600">0:60</p>
                </div>
                <button class="mt-6 w-full bg-gray-300 hover:bg-gray-400 text-gray-900 font-bold py-2 rounded-xl transition-colors" onclick="navigate('home')">Back to Home</button>
            `;
            renderContent(html);
            
            const breathingCircle = document.getElementById('breathing-circle');
            const breathingTimer = document.getElementById('breathing-timer');
            const breathingInstruction = document.getElementById('breathing-instruction');
            let timer;
            let count = 60;
            let isBreathing = false;

            function startBreathing() {
                if (isBreathing) return;
                isBreathing = true;
                breathingInstruction.textContent = "Breathe in... hold... breathe out...";
                breathingCircle.style.animationPlayState = 'running';
                
                timer = setInterval(() => {
                    count--;
                    breathingTimer.textContent = `0:${count.toString().padStart(2, '0')}`;
                    if (count <= 0) {
                        clearInterval(timer);
                        isBreathing = false;
                        breathingCircle.style.animationPlayState = 'paused';
                        breathingInstruction.textContent = "Exercise complete! Feel more centered?";
                        breathingTimer.textContent = "Done!";
                        count = 60; // Reset for next time

                        // Add points for the mindful moment
                        state.totalPoints += 25;
                        setStoredData('mindspace_total_points', state.totalPoints);
                        showMessage('Exercise complete! You earned 25 points.');
                    }
                }, 1000);
            }

            breathingCircle.addEventListener('click', startBreathing);
            // Initial animation state
            breathingCircle.style.animationPlayState = 'paused';
        }

        function renderInsightsPage() {
            let insightsHtml;
            if (state.dailyData.length === 0) {
                insightsHtml = `<p class="text-gray-600 text-center py-8">No data yet. Complete a daily check-in to see your insights!</p>`;
            } else {
                // Calculate average mood and energy
                const totalMood = state.dailyData.reduce((sum, entry) => sum + entry.mood, 0);
                const totalEnergy = state.dailyData.reduce((sum, entry) => sum + entry.energy, 0);
                const averageMood = (totalMood / state.dailyData.length).toFixed(1);
                const averageEnergy = (totalEnergy / state.dailyData.length).toFixed(1);

                // Find last entry for a quick summary
                const lastEntry = state.dailyData[state.dailyData.length - 1];

                insightsHtml = `
                    <div class="bg-gray-100 p-6 rounded-xl">
                        <h2 class="text-xl font-bold mb-4 text-gray-900">Your Mental Health Trends</h2>
                        <div class="grid grid-cols-2 gap-4 text-center mb-6">
                            <div>
                                <p class="text-gray-600 text-sm">Average Mood</p>
                                <p class="text-3xl font-bold text-green-600">${averageMood}</p>
                            </div>
                            <div>
                                <p class="text-gray-600 text-sm">Average Energy</p>
                                <p class="text-3xl font-bold text-green-600">${averageEnergy}</p>
                            </div>
                        </div>

                        <div class="flex justify-center mb-6">
                            <canvas id="insights-chart" width="300" height="200" class="bg-white rounded-xl p-4"></canvas>
                        </div>
                        
                        <h3 class="font-bold text-lg mb-2 text-gray-900">Recent Reflections:</h3>
                        <div class="space-y-4 max-h-60 overflow-y-auto">
                            ${state.dailyData.slice(-3).reverse().map(entry => `
                                <div class="bg-white p-4 rounded-lg border border-gray-400">
                                    <p class="text-sm text-gray-600 mb-1">${entry.date}</p>
                                    <p class="text-gray-800">${entry.journal}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            const backButtonHtml = `<button class="mt-4 w-full bg-gray-300 hover:bg-gray-400 text-gray-900 font-bold py-2 rounded-xl transition-colors" onclick="navigate('home')">Back to Home</button>`;
            renderContent(insightsHtml + backButtonHtml);
            
            // Render the chart after the content is in the DOM
            if (state.dailyData.length > 0) {
                renderChart();
            }
        }
        
        // New function to render the data chart
        function renderChart() {
            const canvas = document.getElementById('insights-chart');
            const ctx = canvas.getContext('2d');
            const data = state.dailyData.slice(-7); // Use the last 7 entries for the chart
            
            // Set canvas size for retina display
            canvas.style.width = '100%';
            canvas.style.height = '200px';
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;

            const moodData = data.map(entry => entry.mood);
            const energyData = data.map(entry => entry.energy);
            const labels = data.map(entry => entry.date);

            const barWidth = canvas.width / (labels.length * 3);
            const maxVal = 100;
            const padding = 20;

            // Clear the canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw axes and labels
            ctx.fillStyle = '#6b7280'; // Gray color
            ctx.font = '10px DM Sans';
            
            // Draw Y-axis labels
            for (let i = 0; i <= 100; i += 25) {
                const y = canvas.height - padding - (i / maxVal) * (canvas.height - 2 * padding);
                ctx.fillText(i, 5, y + 3);
            }

            // Draw bars
            data.forEach((entry, index) => {
                const x = padding + index * (barWidth * 3);
                
                // Mood bar (green)
                const moodBarHeight = (entry.mood / maxVal) * (canvas.height - 2 * padding);
                ctx.fillStyle = '#16a34a'; // A darker green for visibility
                ctx.fillRect(x, canvas.height - padding - moodBarHeight, barWidth, moodBarHeight);
                
                // Energy bar (light green)
                const energyBarHeight = (entry.energy / maxVal) * (canvas.height - 2 * padding);
                ctx.fillStyle = '#22c55e';
                ctx.fillRect(x + barWidth, canvas.height - padding - energyBarHeight, barWidth, energyBarHeight);

                // Draw X-axis labels (dates)
                ctx.fillStyle = '#6b7280';
                ctx.fillText(labels[index], x + barWidth, canvas.height - 5);
            });
        }

        function renderSupportPage() {
            const html = `
                <div class="bg-gray-100 p-6 rounded-xl">
                    <h2 class="text-xl font-bold mb-4 text-center text-gray-900">My Support Card</h2>
                    <p class="text-gray-600 text-center mb-4">Create a card to help you talk with your parents or coaches about what you need to succeed.</p>
                    <form id="support-card-form">
                        <div class="mb-4">
                            <label for="feelings" class="block text-gray-600 mb-2">When I feel pressure, I need you to:</label>
                            <textarea id="feelings" class="w-full p-3 bg-white border border-gray-400 rounded-xl focus:outline-none focus:border-green-500 transition-colors" rows="3" placeholder="Example: Just listen, don't give advice. Remind me to take a break."></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="goals" class="block text-gray-600 mb-2">My personal goals are:</label>
                            <textarea id="goals" class="w-full p-3 bg-white border border-gray-400 rounded-xl focus:outline-none focus:border-green-500 transition-colors" rows="3" placeholder="Example: To have fun and improve my skills, not just to win."></textarea>
                        </div>
                        <div class="mb-4">
                            <label for="best-support" class="block text-gray-600 mb-2">The best way you can support me is:</label>
                            <textarea id="best-support" class="w-full p-3 bg-white border border-gray-400 rounded-xl focus:outline-none focus:border-green-500 transition-colors" rows="3" placeholder="Example: Cheer me on no matter the outcome. Ask me how I felt, not what the score was."></textarea>
                        </div>
                        <button type="submit" class="w-full bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-xl transition-colors">Save My Card</button>
                    </form>
                </div>
                <button class="mt-4 w-full bg-gray-300 hover:bg-gray-400 text-gray-900 font-bold py-2 rounded-xl transition-colors" onclick="navigate('home')">Back to Home</button>
            `;
            renderContent(html);
            
            const form = document.getElementById('support-card-form');
            form.feelings.value = state.supportCardData.feelings || '';
            form.goals.value = state.supportCardData.goals || '';
            form.bestSupport.value = state.supportCardData.bestSupport || '';

            form.addEventListener('submit', handleSupportCardSubmit);
        }

        function handleSupportCardSubmit(event) {
            event.preventDefault();
            const form = event.target;
            state.supportCardData = {
                feelings: form.feelings.value,
                goals: form.goals.value,
                bestSupport: form.bestSupport.value,
            };
            setStoredData('mindspace_support_card', state.supportCardData);
            showMessage('Support Card saved! You can share this with your team whenever you feel ready.');
            navigate('home');
        }

        function renderConnectWithProsPage() {
            const html = `
                <div class="bg-gray-100 p-6 rounded-xl">
                    <h2 class="text-xl font-bold mb-4 text-center text-gray-900">Connect with Pro Athletes</h2>
                    <p class="text-gray-600 text-center mb-6">Find a mentor who can help you with your mental game.</p>
                    
                    <div class="space-y-4">
                        ${state.mentorProfiles.map(mentor => `
                            <div class="bg-white p-4 rounded-xl flex items-center space-x-4">
                                <img src="${mentor.image}" alt="${mentor.name}" class="w-16 h-16 rounded-full border-2 border-green-600">
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold text-gray-900">${mentor.name}</h3>
                                    <p class="text-sm text-gray-600">${mentor.sport} Mentor</p>
                                    <p class="text-xs text-gray-800 mt-1">${mentor.bio}</p>
                                    <button class="mt-2 text-green-600 hover:text-green-500 text-sm font-semibold transition-colors" onclick="showMessage('Chat with ${mentor.name} booked! You will receive a confirmation shortly.')">
                                        Book a Chat
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <button class="mt-4 w-full bg-gray-300 hover:bg-gray-400 text-gray-900 font-bold py-2 rounded-xl transition-colors" onclick="navigate('home')">Back to Home</button>
            `;
            renderContent(html);
        }

        // --- New Rewards Store Functionality ---

        function renderRewardsPage() {
            const storeHtml = `
                <div class="bg-gray-100 p-6 rounded-xl">
                    <h2 class="text-xl font-bold mb-4 text-center text-gray-900">Mindful Rewards Store</h2>
                    <p class="text-gray-600 text-center mb-4">Your Points: <span class="text-green-600 font-bold">${state.totalPoints}</span></p>
                    <div class="space-y-4">
                        ${state.rewardsItems.map(item => `
                            <div class="bg-white p-4 rounded-xl flex items-center justify-between">
                                <div class="flex items-center space-x-4">
                                    <span class="text-3xl">${item.emoji}</span>
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900">${item.name}</h3>
                                        <p class="text-sm text-gray-600">${item.description}</p>
                                    </div>
                                </div>
                                <button class="bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-4 rounded-xl transition-colors" onclick="purchaseItem('${item.id}', ${item.cost})">
                                    ${item.cost} pts
                                </button>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            const inventoryHtml = `
                <div class="bg-gray-100 p-6 rounded-xl mt-4">
                    <h2 class="text-xl font-bold mb-4 text-center text-gray-900">My Rewards Inventory</h2>
                    <div class="space-y-4">
                        ${state.inventory.length > 0 ?
                            state.inventory.map(item => `
                                <div class="bg-white p-4 rounded-xl flex items-center space-x-4">
                                    <span class="text-3xl">${item.emoji}</span>
                                    <div>
                                        <h3 class="text-lg font-bold text-gray-900">${item.name}</h3>
                                        <p class="text-sm text-gray-600">Purchased: ${new Date(item.purchaseDate).toLocaleDateString()}</p>
                                    </div>
                                </div>
                            `).join('') :
                            `<p class="text-gray-600 text-center">You haven't purchased any rewards yet!</p>`
                        }
                    </div>
                </div>
            `;

            const backButtonHtml = `<button class="mt-4 w-full bg-gray-300 hover:bg-gray-400 text-gray-900 font-bold py-2 rounded-xl transition-colors" onclick="navigate('home')">Back to Home</button>`;

            renderContent(storeHtml + inventoryHtml + backButtonHtml);
        }

        function purchaseItem(itemId, cost) {
            if (state.totalPoints >= cost) {
                // Find the item to add to the inventory
                const item = state.rewardsItems.find(i => i.id === itemId);
                if (item) {
                    state.totalPoints -= cost;
                    state.inventory.push({ ...item, purchaseDate: new Date().toISOString() });
                    setStoredData('mindspace_total_points', state.totalPoints);
                    setStoredData('mindspace_inventory', state.inventory);
                    showMessage(`Success! You purchased a ${item.name} for ${cost} points.`);
                    renderRewardsPage(); // Re-render the page to show updated points and inventory
                }
            } else {
                showMessage(`Not enough points! You need ${cost - state.totalPoints} more points to buy this.`);
            }
        }

        // --- Navigation Logic ---

        function navigate(view) {
            state.currentView = view;
            if (view === 'home') {
                renderHomePage();
            } else if (view === 'check-in') {
                renderCheckInPage();
            } else if (view === 'mindful-moments') {
                renderMindfulMoments();
            } else if (view === 'insights') {
                renderInsightsPage();
            } else if (view === 'support-card') {
                renderSupportPage();
            } else if (view === 'connect-with-pros') {
                renderConnectWithProsPage();
            } else if (view === 'rewards') {
                renderRewardsPage();
            }
        }
        
        // Initial render
        document.addEventListener('DOMContentLoaded', () => {
            navigate('home');
        });
    </script>
</body>
</html>
ÔøΩ
